<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Block Jumper â€“ Full Upgrade</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet"/>
  <style>
    body {
      font-family: 'Press Start 2P', cursive;
      background: #333;
      color: #fff;
      margin:0;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      min-height: 100vh;
    }
    #gameHeader {
      width: 100%;
      max-width: 800px;
      box-sizing: border-box;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      background: #222;
      padding: 10px 20px;
      border: 4px solid #000;
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }
    h1 { 
      font-size:1.25rem;
      color:#4ade80; 
      text-shadow:2px 2px #000; 
      margin: 5px 0;
    }
    #hud {
      font-size: 0.9rem;
      margin: 5px 0;
      display: flex;
      gap: 1.5rem;
    }
    .hud-item {
      color: #fff;
      display: inline-flex;
      align-items: center;
    }
    .hud-value {
      color: #fde047;
      font-weight: bold;
      margin-left: 0.5rem;
      min-width: 20px;
    }
    canvas {
      background:#5c94fc;
      border:4px solid #000;
      border-radius:8px;
      box-shadow:0 0 20px rgba(0,0,0,0.5);
      max-width:100%;
      max-height:80vh;
      aspect-ratio:16/9;
      display: block;
    }
    #messageBox {
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      background:rgba(0,0,0,0.9);
      padding:30px 40px;
      border-radius:10px;
      text-align:center;
      font-size:1.5rem;
      display:none;
      z-index:10;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
      border: 2px solid #fff;
    }
    #messageBox button {
      font-family:'Press Start 2P',cursive;
      font-size:1rem;
      background:#4ade80;
      color:#000;
      border:2px solid #000;
      padding:10px 20px;
      margin-top:20px;
      cursor:pointer;
      border-radius:5px;
      transition: background-color 0.2s;
    }
    #messageBox button:hover {
      background:#fff;
    }

    #muteButton {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #4ade80;
      color: #000;
      font-family: 'Press Start 2P', cursive;
      font-size: 0.7rem;
      padding: 6px 10px;
      border: 2px solid #000;
      border-radius: 5px;
      cursor: pointer;
      z-index: 20;
      transition: background-color 0.2s;
    }
    #muteButton:hover {
      background: #fff;
    }
    
    @media (max-width: 600px) {
      h1 {
        font-size: 1rem;
        width: 100%;
        text-align: center;
      }
      #hud {
        font-size: 0.8rem;
        gap: 1rem;
        width: 100%;
        justify-content: center;
      }
      #gameHeader {
        padding: 10px;
      }
      #messageBox {
         font-size: 1.2rem;
         padding: 20px;
         width: 80%;
      }
      #messageBox button {
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>

<header id="gameHeader">
  <h1>Block Jumper â€“ Full Upgrade</h1>
  <div id="hud">
    <span class="hud-item">Level: <span id="levelDisplay" class="hud-value">1</span></span>
    <span class="hud-item">Lives: <span id="livesDisplay" class="hud-value">3</span></span>
    <span class="hud-item">Coins: <span id="coinsDisplay" class="hud-value">0</span></span>
  </div>
</header>

<canvas id="gameCanvas" width="800" height="450"></canvas>
<button id="muteButton">ðŸ”Š Mute</button>

<div id="messageBox">
  <p id="messageText"></p>
  <button id="restartButton">Start Game</button>
</div>

<script>
// --- Game Setup ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const hudLevel = document.getElementById('levelDisplay');
const hudLives = document.getElementById('livesDisplay');
const hudCoins = document.getElementById('coinsDisplay');
const messageBox = document.getElementById('messageBox');
const messageText = document.getElementById('messageText');
const restartButton = document.getElementById('restartButton');

// --- Game Constants ---
const gravity = 0.6;
const friction = 0.80;
const airFriction = 0.98;
const shootCooldown = 300;
const powerUpDuration = 10000;

// --- Game State ---
let keys = {};
let currentLevel = 1;
let lives = 3;
let coins = 0;
let cameraX = 0;
let levelWidth = 0;
let gameRunning = false;
let gameLoopId = null;

let player = {
  x: 50, y: 300, width: 32, height: 32,
  vx: 0, vy: 0, speed: 6, jumpPower: 14,
  jumps: 0, maxJumps: 2, direction: 1,
  lastShot: 0, poweredUp: false, powerUpTimer: 0
};

let platforms = [];
let enemies = [];
let bullets = [];
let coinsOnLevel = [];
let powerUps = [];
let goal = {};
// --- Levels ---
const levelData = [
  {
    platforms: [
      {x:0,y:400,width:200,height:50},
      {x:250,y:350,width:150,height:20},
      {x:450,y:300,width:200,height:20},
      {x:700,y:350,width:100,height:20},
      {x:850,y:250,width:150,height:20},
      {x:1050,y:200,width:200,height:20}
    ],
    enemies: [
      {x:300,y:320,width:32,height:32,vx:2},
      {x:500,y:270,width:32,height:32,vx:1.5}
    ],
    coins: [
      {x:260,y:310,width:16,height:16},
      {x:470,y:260,width:16,height:16},
      {x:860,y:210,width:16,height:16},
      {x:1070,y:160,width:16,height:16}
    ],
    powerUps: [
      {x:750,y:310,width:16,height:16,type:'jump'},
      {x:1100,y:160,width:16,height:16,type:'speed'}
    ],
    goal: {x:1200,y:150,width:50,height:50}
  },
  // Additional levels can be defined similarly
];

// --- Helpers ---
function rectsCollide(a,b){
  return a.x < b.x + b.width &&
         a.x + a.width > b.x &&
         a.y < b.y + b.height &&
         a.y + a.height > b.y;
}

function resetPlayer() {
  player.x = 50;
  player.y = 300;
  player.vx = 0;
  player.vy = 0;
  player.jumps = 0;
  player.poweredUp = false;
  player.powerUpTimer = 0;
}

// --- Game Initialization ---
function loadLevel(n){
  const level = levelData[n-1];
  platforms = level.platforms.map(p=>({...p}));
  enemies = level.enemies.map(e=>({...e}));
  coinsOnLevel = level.coins.map(c=>({...c}));
  powerUps = level.powerUps.map(pu=>({...pu}));
  goal = {...level.goal};
  levelWidth = Math.max(...platforms.map(p=>p.x+p.width), goal.x+goal.width);
  resetPlayer();
  updateHUD();
}

function updateHUD(){
  hudLevel.textContent = currentLevel;
  hudLives.textContent = lives;
  hudCoins.textContent = coins;
}

// --- Input ---
document.addEventListener('keydown', e=>{keys[e.code]=true});
document.addEventListener('keyup', e=>{keys[e.code]=false});

// --- Game Loop ---
function update(){
  // Horizontal movement
  if(keys['ArrowLeft'] || keys['KeyA']){
    player.vx = -player.speed;
    player.direction = -1;
  } else if(keys['ArrowRight'] || keys['KeyD']){
    player.vx = player.speed;
    player.direction = 1;
  } else {
    player.vx *= friction;
  }

  // Jump
  if((keys['ArrowUp'] || keys['Space'] || keys['KeyW']) && player.jumps < player.maxJumps){
    player.vy = -player.jumpPower;
    player.jumps++;
    keys['ArrowUp']=keys['Space']=keys['KeyW']=false; // Prevent repeated jump
  }

  // Apply gravity
  player.vy += gravity;
  player.vx *= airFriction;

  // Move player
  player.x += player.vx;
  player.y += player.vy;

  // Collision with platforms
  let onGround = false;
  for(let plat of platforms){
    if(rectsCollide(player,plat)){
      if(player.vy > 0 && player.y + player.height - player.vy <= plat.y){
        player.y = plat.y - player.height;
        player.vy = 0;
        player.jumps = 0;
        onGround = true;
      } else if(player.vy < 0 && player.y - player.vy >= plat.y + plat.height){
        player.y = plat.y + plat.height;
        player.vy = 0;
      } else if(player.vx > 0){
        player.x = plat.x - player.width;
        player.vx = 0;
      } else if(player.vx < 0){
        player.x = plat.x + plat.width;
        player.vx = 0;
      }
    }
  }

  // Enemy collisions
  for(let e of enemies){
    e.x += e.vx;
    if(e.x < 0 || e.x + e.width > levelWidth) e.vx*=-1;
    if(rectsCollide(player,e)){
      lives--;
      if(lives<=0){
        endGame('Game Over!');
        return;
      } else {
        resetPlayer();
        updateHUD();
      }
    }
  }

  // Coin collection
  for(let i=coinsOnLevel.length-1;i>=0;i--){
    if(rectsCollide(player,coinsOnLevel[i])){
      coins++;
      coinsOnLevel.splice(i,1);
      updateHUD();
    }
  }

  // Power-ups
  for(let i=powerUps.length-1;i>=0;i--){
    if(rectsCollide(player,powerUps[i])){
      const pu = powerUps[i];
      if(pu.type==='jump') player.maxJumps = 3;
      else if(pu.type==='speed') player.speed = 10;
      player.poweredUp = true;
      player.powerUpTimer = Date.now();
      powerUps.splice(i,1);
    }
  }

  // Power-up expiration
  if(player.poweredUp && Date.now() - player.powerUpTimer > powerUpDuration){
    player.poweredUp=false;
    player.maxJumps=2;
    player.speed=6;
  }

  // Goal
  if(rectsCollide(player,goal)){
    currentLevel++;
    if(currentLevel>levelData.length){
      endGame('You Win!');
      return;
    } else {
      loadLevel(currentLevel);
    }
  }

  // Fall off level
  if(player.y > canvas.height + 100){
    lives--;
    if(lives<=0){
      endGame('Game Over!');
      return;
    } else {
      resetPlayer();
      updateHUD();
    }
  }

  cameraX = Math.max(0, player.x - canvas.width/3);
}
// --- Rendering ---
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Background
  ctx.fillStyle = '#87CEEB';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Platforms
  ctx.fillStyle = '#654321';
  for(let plat of platforms){
    ctx.fillRect(plat.x - cameraX, plat.y, plat.width, plat.height);
  }

  // Coins
  ctx.fillStyle = 'gold';
  for(let c of coinsOnLevel){
    ctx.beginPath();
    ctx.arc(c.x - cameraX + c.width/2, c.y + c.height/2, c.width/2,0,Math.PI*2);
    ctx.fill();
  }

  // Power-ups
  ctx.fillStyle = 'purple';
  for(let pu of powerUps){
    ctx.fillRect(pu.x - cameraX, pu.y, pu.width, pu.height);
  }

  // Goal
  ctx.fillStyle = 'green';
  ctx.fillRect(goal.x - cameraX, goal.y, goal.width, goal.height);

  // Enemies
  ctx.fillStyle = 'red';
  for(let e of enemies){
    ctx.fillRect(e.x - cameraX, e.y, e.width, e.height);
  }

  // Player
  ctx.fillStyle = player.poweredUp ? 'orange' : 'blue';
  ctx.fillRect(player.x - cameraX, player.y, player.width, player.height);
}

// --- Shooting ---
function shoot(){
  if(Date.now() - lastBulletTime < bulletCooldown) return;
  bullets.push({x:player.x + player.width/2, y:player.y + player.height/2, vx:10*player.direction, width:8, height:4});
  lastBulletTime = Date.now();
}

document.addEventListener('keydown', e=>{
  if(e.code === 'KeyJ') shoot();
});

// Update bullets
function updateBullets(){
  for(let i=bullets.length-1;i>=0;i--){
    let b = bullets[i];
    b.x += b.vx;
    if(b.x < 0 || b.x > levelWidth){
      bullets.splice(i,1);
      continue;
    }

    // Check collision with enemies
    for(let j=enemies.length-1;j>=0;j--){
      if(rectsCollide(b,enemies[j])){
        enemies.splice(j,1);
        bullets.splice(i,1);
        coins+=5;
        updateHUD();
        break;
      }
    }
  }
}

// Draw bullets
function drawBullets(){
  ctx.fillStyle='black';
  for(let b of bullets){
    ctx.fillRect(b.x - cameraX, b.y, b.width, b.height);
  }
}

// --- Advanced Enemy Movement ---
function updateEnemies(){
  for(let e of enemies){
    e.x += e.vx;
    if(e.x < 0 || e.x + e.width > levelWidth) e.vx*=-1;
  }
}

// --- Game Over ---
function endGame(msg){
  alert(msg);
  location.reload();
}

// --- Main Loop ---
function loop(){
  update();
  updateBullets();
  draw();
  drawBullets();
  requestAnimationFrame(loop);
}

// --- Start Game ---
loadLevel(currentLevel);
loop();
// --- HUD ---
function updateHUD(){
  document.getElementById('score').textContent = 'Coins: '+coins;
  document.getElementById('level').textContent = 'Level: '+currentLevel;
}

// --- Key Events ---
document.addEventListener('keydown', e=>{
  if(e.code === 'ArrowRight') keys.right=true;
  if(e.code === 'ArrowLeft') keys.left=true;
  if(e.code === 'Space') keys.up=true;
});

document.addEventListener('keyup', e=>{
  if(e.code === 'ArrowRight') keys.right=false;
  if(e.code === 'ArrowLeft') keys.left=false;
  if(e.code === 'Space') keys.up=false;
});

// --- Canvas Setup ---
const canvas=document.createElement('canvas');
canvas.width=800;
canvas.height=600;
document.body.appendChild(canvas);
const ctx=canvas.getContext('2d');

// --- HUD Elements ---
const hud=document.createElement('div');
hud.style.position='absolute';
hud.style.top='10px';
hud.style.left='10px';
hud.style.color='white';
hud.style.font='20px Arial';
hud.innerHTML='<span id="score">Coins: 0</span> | <span id="level">Level: 1</span>';
document.body.appendChild(hud);

// --- Initialization ---
let keys={left:false,right:false,up:false};
let player={x:100,y:500,width:40,height:60,vx:0,vy:0,jumping:false,poweredUp:false,direction:1};
let platforms=[];
let coinsOnLevel=[];
let enemies=[];
let powerUps=[];
let bullets=[];
let cameraX=0;
let coins=0;
let lastBulletTime=0;
let bulletCooldown=500;
let currentLevel=0;
let goal={x:900,y:500,width:40,height:60};
let levelWidth=2000;

// --- Start Game ---
loadLevel(currentLevel);
updateHUD();
loop();
