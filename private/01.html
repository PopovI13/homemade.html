<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Star Wars: Galaxy Annihilator</title>
<style>
  /* Basic reset */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0;
    overflow: hidden;
    background: black;
    font-family: 'Orbitron', sans-serif, monospace;
    color: #ffe81f;
    user-select: none;
  }
  #gameCanvas {
    display: block;
    margin: 0 auto;
    background: black;
    cursor: none;
  }
  #ui {
    position: absolute;
    top: 10px;
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
    font-weight: bold;
    font-size: 1.3rem;
    pointer-events: none;
  }
  #lives {
    pointer-events: auto;
  }
  .life {
    width: 30px;
    height: 30px;
    display: inline-block;
    margin-left: 6px;
    background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgdmlld0JveD0iMCAwIDgwIDYwIj48cGF0aCBkPSJNNCAzMGMyMSAwIDIxIDE5IDQwIDE5czE5LTE5IDQwLTE5djIuM2MwIDExLjQtMTMuNCAyMC43LTMwIDIwLjdoLTIwYy0xNi42IDAtMzAtOS4zLTMwLTIwLjdWMzB6IiBmaWxsPSIjYjBiMGIwIi8+PHBhdGggZD0iTTMwIDMzaDE4djJoLTE4eiIgZmlsbD0iIzgwODA4MCIvPjxwYXRoIGQ9Ik0zMyA1My41bDEuNS0yLjVoMTJsMS41IDIuNXoiIGZpbGw9IiM4MDgwODAiLz48cGF0aCBkPSJNNCAzMGg3MmMwLTEyLjctMTYtMjMtMzYtMjNTNCAxNy4zIDQgMzB6IiBmaWxsPSIjZDZkNmQ2Ii8+PHBhdGggZD0iTTI1IDMwYzAgMy4zIDEuMyA2IDIuOSA4LjNsMS4yLTMuN2MtLjYtMS4yLTEtMi42LTEtNC4xIDAtNC40IDMuMi04IDcuMS04czcuMSA0IDcgOC41YzAgMS43LS41IDMuMy0xLjMgNC44bDEuMyAzLjVjMS44LTIuNSAyLjktNS41IDIuOS04LjkgMC03LjYtNi4yLTE0LTExLTE0cy0xMSA2LjQtMTEgMTR6IiBmaWxsPSIjYjBiMGIwIi8+PHBhdGggZD0iTTUwIDMwaDE2djIuNUg1MHoiIGZpbGw9IiM4MDgwODAiLz48cGF0aCBkPSJNNTQuNSA0MC41aDEwdjJoLTEweiIgZmlsbD0iIzgwODA4MCIvPjxwYXRoIGQ9Ik01MCAzNWgxM3YyaC0xM3oiIGZpbGw9IiM4MDgwODAiLz48cGF0aCBkPSJNNjIgMjdjMCAyLjggMS4xIDUuMyAyLjkgNy4zbDEuMi0zLjJjLS43LTEtMS4xLTIuMy0xLjEtMy42IDAtMy44IDIuOC03IDYtN3M2IDMuMSA2IDYuNWMwIDEuNS0uNCAzLTEuMiA0LjJsMS4yIDIuOWMyLTIuMiAzLjEtNS4xIDMuMS04LjIgMC02LjctNS4yLTEyLTExLTEycy0xMSA1LjMtMTEgMTJ6IiBmaWxsPSIjYjBiMGIwIi8+PC9zdmc+');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
  }
  #modal {
    position: absolute;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.85);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: #ffe81f;
    font-size: 2.5rem;
    font-weight: bold;
    z-index: 999;
  }
  #modal button {
    margin-top: 25px;
    background: #ffe81f;
    color: black;
    border: none;
    padding: 15px 40px;
    font-size: 1.3rem;
    font-weight: bold;
    border-radius: 9999px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #modal button:hover {
    background: #ffdb47;
  }
</style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="600"></canvas>
  <div id="ui">
    <div>Score: <span id="score">0</span></div>
    <div id="lives">Lives:</div>
  </div>
  <div id="modal">
    <div>GAME OVER</div>
    <div>Score: <span id="finalScore">0</span></div>
    <button id="startBtn">Start Game</button>
  </div>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const livesEl = document.getElementById('lives');
  const modal = document.getElementById('modal');
  const finalScoreEl = document.getElementById('finalScore');
  const startBtn = document.getElementById('startBtn');

  // Starry background
  const stars = [];
  const STAR_COUNT = 150;
  for(let i=0; i<STAR_COUNT; i++) {
    stars.push({
      x: Math.random()*canvas.width,
      y: Math.random()*canvas.height,
      radius: Math.random()*1.3 + 0.3,
      alpha: Math.random()
    });
  }

  // Game Variables
  let player, projectiles, enemies, powerUps, score, lives, shieldActive;
  let keys = { left:false, right:false, space:false };
  let gameRunning = false;
  let shootCooldown = 0;
  let spawnTimer = 0;

  class Player {
    constructor() {
      this.width = 50;
      this.height = 50;
      this.x = canvas.width/2 - this.width/2;
      this.y = canvas.height - this.height - 30;
      this.speed = 6;
      this.velocityX = 0;
    }
    update() {
      this.velocityX = 0;
      if(keys.left) this.velocityX = -this.speed;
      if(keys.right) this.velocityX = this.speed;
      this.x += this.velocityX;
      if(this.x < 0) this.x = 0;
      if(this.x + this.width > canvas.width) this.x = canvas.width - this.width;
    }
    draw() {
      ctx.save();
      if(shieldActive){
        ctx.shadowColor = '#0ff';
        ctx.shadowBlur = 20;
      }
      ctx.fillStyle = '#00b0b0';
      ctx.beginPath();
      ctx.moveTo(this.x + this.width/2, this.y);
      ctx.lineTo(this.x + this.width, this.y + this.height);
      ctx.lineTo(this.x, this.y + this.height);
      ctx.closePath();
      ctx.fill();
      ctx.restore();
    }
  }

  class Projectile {
    constructor(x,y) {
      this.x = x;
      this.y = y;
      this.radius = 5;
      this.speed = 10;
      this.color = '#ff5733';
    }
    update() {
      this.y -= this.speed;
    }
    draw() {
      ctx.beginPath();
      ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);
      ctx.fillStyle = this.color;
      ctx.fill();
      ctx.closePath();
    }
  }

  class Enemy {
    constructor(x,y,type='normal') {
      this.x = x;
      this.y = y;
      this.width = 40;
      this.height = 40;
      this.type = type;
      this.speed = type === 'hard' ? 2.2 : 1.2;
      this.color = type === 'hard' ? '#ff4444' : '#ddd';
    }
    update() {
      this.y += this.speed;
    }
    draw() {
      ctx.fillStyle = this.color;
      ctx.fillRect(this.x,this.y,this.width,this.height);
    }
  }

  class PowerUp {
    constructor(x,y) {
      this.x = x;
      this.y = y;
      this.radius = 12;
      this.speed = 2;
      this.color = '#0ff';
    }
    update() {
      this.y += this.speed;
    }
    draw() {
      ctx.beginPath();
      ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);
      ctx.strokeStyle = this.color;
      ctx.lineWidth = 3;
      ctx.stroke();
      ctx.closePath();
    }
  }

  function resetGame() {
    player = new Player();
    projectiles = [];
    enemies = [];
    powerUps = [];
    score = 0;
    lives = 3;
    shieldActive = false;
    shootCooldown = 0;
    spawnTimer = 0;
    scoreEl.textContent = score;
    updateLivesUI();
    gameRunning = true;
    modal.style.display = 'none';
  }

  function updateLivesUI() {
    // Clear previous
    while(livesEl.children.length > 1) livesEl.removeChild(livesEl.lastChild);
    for(let i=0; i<lives; i++) {
      const lifeSpan = document.createElement('span');
      lifeSpan.classList.add('life');
      livesEl.appendChild(lifeSpan);
    }
  }

  // Collision checks
  function rectsCollide(r1, r2) {
    return !(r1.x + r1.width < r2.x || r1.x > r2.x + r2.width || r1.y + r1.height < r2.y || r1.y > r2.y + r2.height);
  }

  function circleRectCollide(circle, rect) {
    // Find closest point to circle center within rect
    const closestX = Math.max(rect.x, Math.min(circle.x, rect.x + rect.width));
    const closestY = Math.max(rect.y, Math.min(circle.y, rect.y + rect.height));

    const dx = circle.x - closestX;
    const dy = circle.y - closestY;

    return (dx*dx + dy*dy) < (circle.radius*circle.radius);
  }

  function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw stars
    for(let star of stars) {
      ctx.beginPath();
      ctx.arc(star.x, star.y, star.radius, 0, Math.PI*2);
      ctx.fillStyle = `rgba(255,255,255,${star.alpha})`;
      ctx.fill();
      star.alpha += (Math.random() - 0.5) * 0.03;
      if(star.alpha < 0.1) star.alpha = 0.1;
      if(star.alpha > 1) star.alpha = 1;
    }

    player.update();
    player.draw();

    // Shoot cooldown
    if(shootCooldown > 0) shootCooldown--;

    if(keys.space && shootCooldown <= 0) {
      projectiles.push(new Projectile(player.x + player.width/2, player.y));
      shootCooldown = 15; // about 4 shots per second
    }

    // Update projectiles
    for(let i=projectiles.length-1; i>=0; i--) {
      const p = projectiles[i];
      p.update();
      if(p.y + p.radius < 0) {
        projectiles.splice(i,1);
        continue;
      }
      // Check collision with enemies
      for(let j=enemies.length-1; j>=0; j--) {
        const e = enemies[j];
        if(circleRectCollide(p, e)) {
          projectiles.splice(i,1);
          enemies.splice(j,1);
          score += e.type === 'hard' ? 20 : 10;
          scoreEl.textContent = score;

          // Hard enemy drops power-up chance
          if(e.type === 'hard' && Math.random() < 0.4) {
            powerUps.push(new PowerUp(e.x + e.width/2, e.y + e.height));
          }
          break;
        }
      }
    }

    // Spawn enemies every ~1 second
    spawnTimer++;
    if(spawnTimer > 60) {
      spawnTimer = 0;
      spawnEnemy();
    }

    // Update enemies
    for(let i=enemies.length-1; i>=0; i--) {
      const e = enemies[i];
      e.update();

      // Enemy hits player
      if(rectsCollide(e, player)) {
        enemies.splice(i,1);
        if(shieldActive) {
          shieldActive = false;
        } else {
          lives--;
          updateLivesUI();
          if(lives <= 0) {
            gameRunning = false;
            showGameOver();
          }
        }
        continue;
      }

      if(e.y > canvas.height) {
        enemies.splice(i,1);
      }
    }

    // Update power-ups
    for(let i=powerUps.length-1; i>=0; i--) {
      const p = powerUps[i];
      p.update();
      // Pickup by player
      const dx = (player.x + player.width/2) - p.x;
      const dy = (player.y + player.height/2) - p.y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if(dist < p.radius + player.width/2) {
        shieldActive = true;
        powerUps.splice(i,1);
      }
      else if(p.y - p.radius > canvas.height) {
        powerUps.splice(i,1);
      }
    }

    // Draw projectiles
    for(let p of projectiles) p.draw();
    // Draw enemies
    for(let e of enemies) e.draw();
    // Draw power-ups
    for(let p of powerUps) p.draw();

    if(gameRunning) requestAnimationFrame(gameLoop);
  }

  function spawnEnemy() {
    const x = Math.random() * (canvas.width - 40);
    const type = Math.random() < 0.25 ? 'hard' : 'normal'; // 25% chance hard
    enemies.push(new Enemy(x, -40, type));
  }

  function showGameOver() {
    finalScoreEl.textContent = score;
    modal.style.display = 'flex';
  }

  // Controls
  window.addEventListener('keydown', (e) => {
    if(e.code === 'ArrowLeft') keys.left = true;
    if(e.code === 'ArrowRight') keys.right = true;
    if(e.code === 'Space') keys.space = true;
  });
  window.addEventListener('keyup', (e) => {
    if(e.code === 'ArrowLeft') keys.left = false;
    if(e.code === 'ArrowRight') keys.right = false;
    if(e.code === 'Space') keys.space = false;
  });

  startBtn.addEventListener('click', () => {
    resetGame();
    gameLoop();
  });

  // Hide cursor on canvas
  canvas.style.cursor = 'none';

  // Initial UI
  updateLivesUI();
})();
</script>
</body>
</html>
