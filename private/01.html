<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Star Wars: Galaxy Annihilator - Updated</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />
<style>
  body {
    margin: 0; padding: 0;
    font-family: 'Orbitron', sans-serif;
    background: black;
    overflow: hidden;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: black;
    cursor: none;
  }
  .game-container {
    position: relative;
    width: 100vw; height: 100vh;
    overflow: hidden;
  }
  .absolute {
    position: absolute;
  }
  #scoreEl {
    font-weight: 700;
    font-size: 1.5rem;
  }
  #livesContainer {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .life {
    width: 30px;
    height: 30px;
    background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgdmlld0JveD0iMCAwIDgwIDYwIj48cGF0aCBkPSJNNCAzMGMyMSAwIDIxIDE5IDQwIDE5czE5LTE5IDQwLTE5djIuM2MwIDExLjQtMTMuNCAyMC43LTMwIDIwLjdoLTIwYy0xNi42IDAtMzAtOS4zLTMwLTIwLjdWMzB6IiBmaWxsPSIjYjBiMGIwIi8+PHBhdGggZD0iTTMwIDMzaDE4djJoLTE4eiIgZmlsbD0iIzgwODA4MCIvPjxwYXRoIGQ9Ik0zMyA1My41bDEuNS0yLjVoMTJsMS41IDIuNXoiIGZpbGw9IiM4MDgwODAiLz48cGF0aCBkPSJNNCAzMGg3MmMwLTEyLjctMTYtMjMtMzYtMjNTNCAxNy4zIDQgMzB6IiBmaWxsPSIjZDZkNmQ2Ii8+PHBhdGggZD0iTTI1IDMwYzAgMy4zIDEuMyA2IDIuOSA4LjNsMS4yLTMuN2MtLjYtMS4yLTEtMi42LTEtNC4xIDAtNC40IDMuMi04IDcuMS04czcuMSA0IDcgOC41YzAgMS43LS41IDMuMy0xLjMgNC44bDEuMyAzLjVjMS44LTIuNSAyLjktNS41IDIuOS04LjkgMC03LjYtNi4yLTE0LTExLTE0cy0xMSA2LjQtMTEgMTR6IiBmaWxsPSIjYjBiMGIwIi8+PHBhdGggZD0iTTUwIDMwaDE2djIuNUg1MHoiIGZpbGw9IiM4MDgwODAiLz48cGF0aCBkPSJNNTQuNSA0MC41aDEwdjJoLTEweiIgZmlsbD0iIzgwODA4MCIvPjxwYXRoIGQ9Ik01MCAzNWgxM3YyaC0xM3oiIGZpbGw9IiM4MDgwODAiLz48cGF0aCBkPSJNNjIgMjdjMCAyLjggMS4xIDUuMyAyLjkgNy4zbDEuMi0zLjJjLS43LTEtMS4xLTIuMy0xLjEtMy42IDAtMy44IDIuOC03IDYtN3M2IDMuMSA2IDYuNWMwIDEuNS0uNCAzLTEuMiA0LjJsMS4yIDIuOWMyLTIuMiAzLjEtNS4xIDMuMS04LjIgMC02LjctNS4yLTEyLTExLTEycy0xMSA1LjMtMTEgMTJ6IiBmaWxsPSIjYjBiMGIwIi8+PC9zdmc+');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
  }
  .modal {
    background-color: rgba(0,0,0,0.85);
    border: 2px solid #FFE81F;
    padding: 2rem;
    border-radius: 12px;
    max-width: 400px;
    text-align: center;
    color: #FFE81F;
  }
  button {
    background-color: #FFE81F;
    border: none;
    padding: 12px 30px;
    font-weight: 700;
    border-radius: 30px;
    cursor: pointer;
    transition: transform 0.3s ease;
    font-family: 'Orbitron', sans-serif;
    color: black;
    margin-top: 20px;
  }
  button:hover {
    background-color: #ffeb3b;
    transform: scale(1.05);
  }
</style>
</head>
<body>
  <div class="game-container">
    <canvas id="starCanvas" style="position:absolute; top:0; left:0; z-index:0;"></canvas>
    <canvas id="gameCanvas" width="800" height="600" style="position:relative; z-index:1;"></canvas>

    <div class="absolute top-4 left-4 text-white z-10" style="font-size:1.5rem; font-weight:700;">
      SCORE: <span id="scoreEl">0</span>
    </div>
    <div class="absolute top-4 right-4 text-white z-10 flex items-center gap-2" id="livesContainer" style="font-size:1.2rem; font-weight:700;">
      LIVES:
    </div>

    <div id="modalEl" class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-90 z-20 hidden">
      <div class="modal">
        <h1 style="font-size:3rem;" id="modalScore">0</h1>
        <p style="font-size:1.2rem;">POINTS</p>
        <button id="startGameBtn">START GAME</button>
        <p style="margin-top: 1rem; font-size:0.9rem; color: white;">
          Use ← → or A/D to move, Space to shoot.<br/>
          Hard enemies drop power-ups!
        </p>
      </div>
    </div>
  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
<script>
(() => {
  const starCanvas = document.getElementById('starCanvas');
  const starCtx = starCanvas.getContext('2d');
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  const scoreEl = document.getElementById('scoreEl');
  const livesContainer = document.getElementById('livesContainer');
  const modalEl = document.getElementById('modalEl');
  const modalScore = document.getElementById('modalScore');
  const startGameBtn = document.getElementById('startGameBtn');

  let score = 0;
  let gameRunning = false;

  const maxWidth = 800;
  const maxHeight = 600;
  const aspectRatio = maxWidth / maxHeight;

  function resizeCanvas() {
    // Resize game canvas
    const screenWidth = window.innerWidth;
    const screenHeight = window.innerHeight;
    if(screenWidth / screenHeight > aspectRatio){
      canvas.height = screenHeight * 0.9;
      canvas.width = canvas.height * aspectRatio;
    } else {
      canvas.width = screenWidth * 0.9;
      canvas.height = canvas.width / aspectRatio;
    }
    // Resize star canvas to same size
    starCanvas.width = canvas.width;
    starCanvas.height = canvas.height;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  // --- Starfield ---
  class Star {
    constructor() {
      this.reset();
    }
    reset() {
      this.x = Math.random() * starCanvas.width;
      this.y = Math.random() * starCanvas.height;
      this.size = Math.random() * 1.5;
      this.speed = this.size * 0.2;
      this.brightness = Math.random();
      this.brightnessDirection = Math.random() > 0.5 ? 1 : -1;
    }
    update() {
      this.y += this.speed;
      if(this.y > starCanvas.height) this.y = 0;
      this.brightness += 0.01 * this.brightnessDirection;
      if(this.brightness >= 1) this.brightnessDirection = -1;
      if(this.brightness <= 0.2) this.brightnessDirection = 1;
    }
    draw(ctx) {
      ctx.beginPath();
      ctx.fillStyle = `rgba(255, 255, 255, ${this.brightness})`;
      ctx.shadowBlur = 10;
      ctx.shadowColor = 'white';
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fill();
    }
  }
  const stars = [];
  for(let i=0; i<150; i++) {
    stars.push(new Star());
  }

  // --- Player ---
  class Player {
    constructor() {
      this.width = 50;
      this.height = 30;
      this.x = canvas.width / 2 - this.width / 2;
      this.y = canvas.height - this.height - 10;
      this.speed = 6;
      this.color = '#00FF00';
      this.lives = 3;
      this.shootCooldown = 0;
      this.powerUp = null; // current power-up (e.g. triple shot)
      this.powerUpTimer = 0;
    }
    move(dir) {
      this.x += dir * this.speed;
      if(this.x < 0) this.x = 0;
      if(this.x + this.width > canvas.width) this.x = canvas.width - this.width;
    }
    update() {
      if(this.shootCooldown > 0) this.shootCooldown--;
      if(this.powerUpTimer > 0) {
        this.powerUpTimer--;
        if(this.powerUpTimer <= 0) {
          this.powerUp = null;
        }
      }
    }
    draw(ctx) {
      ctx.fillStyle = this.color;
      ctx.beginPath();
      // Simple spaceship shape
      ctx.moveTo(this.x + this.width/2, this.y);
      ctx.lineTo(this.x, this.y + this.height);
      ctx.lineTo(this.x + this.width, this.y + this.height);
      ctx.closePath();
      ctx.fill();
      // Draw shield if powerup active
      if(this.powerUp === 'shield') {
        ctx.strokeStyle = 'cyan';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.arc(this.x + this.width/2, this.y + this.height/2, this.width, 0, Math.PI * 2);
        ctx.stroke();
      }
    }
    shoot() {
      if(this.shootCooldown <= 0) {
        this.shootCooldown = 15;
        if(this.powerUp === 'triple') {
          bullets.push(new Bullet(this.x + this.width/2, this.y, 0));
          bullets.push(new Bullet(this.x + this.width/2, this.y, -0.3));
          bullets.push(new Bullet(this.x + this.width/2, this.y, 0.3));
        } else {
          bullets.push(new Bullet(this.x + this.width/2, this.y, 0));
        }
      }
    }
  }

  // --- Bullet ---
  class Bullet {
    constructor(x, y, angle=0) {
      this.x = x;
      this.y = y;
      this.radius = 4;
      this.speed = 10;
      this.angle = angle;
      this.dx = this.speed * Math.sin(this.angle);
      this.dy = -this.speed * Math.cos(this.angle);
      this.color = '#FFD700';
    }
    update() {
      this.x += this.dx;
      this.y += this.dy;
    }
    draw(ctx) {
      ctx.beginPath();
      ctx.fillStyle = this.color;
      ctx.shadowColor = 'gold';
      ctx.shadowBlur = 10;
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  // --- Enemy ---
  class Enemy {
    constructor(type = 'basic') {
      this.type = type;
      this.width = type === 'basic' ? 40 : 60;
      this.height = type === 'basic' ? 30 : 45;
      this.x = Math.random() * (canvas.width - this.width);
      this.y = -this.height;
      this.speed = type === 'basic' ? 2 + Math.random() * 1 : 3.5 + Math.random() * 1.5;
      this.color = type === 'basic' ? '#FF5555' : '#FF00FF';
      this.health = type === 'basic' ? 1 : 3;
      this.points = type === 'basic' ? 10 : 50;
      this.dropPowerUp = type === 'hard'; // only hard enemy drops powerups
    }
    update() {
      this.y += this.speed;
    }
    draw(ctx) {
      ctx.fillStyle = this.color;
      ctx.beginPath();
      // Enemy shape: a diamond
      ctx.moveTo(this.x + this.width/2, this.y);
      ctx.lineTo(this.x, this.y + this.height/2);
      ctx.lineTo(this.x + this.width/2, this.y + this.height);
      ctx.lineTo(this.x + this.width, this.y + this.height/2);
      ctx.closePath();
      ctx.fill();
    }
  }

  // --- PowerUp ---
  class PowerUp {
    constructor(x, y, kind) {
      this.x = x;
      this.y = y;
      this.radius = 15;
      this.kind = kind; // 'shield' or 'triple'
      this.speed = 2;
      this.color = kind === 'shield' ? 'cyan' : 'yellow';
    }
    update() {
      this.y += this.speed;
    }
    draw(ctx) {
      ctx.beginPath();
      ctx.fillStyle = this.color;
      ctx.shadowColor = this.color;
      ctx.shadowBlur = 20;
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = 'black';
      ctx.font = 'bold 14px Orbitron, sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(this.kind === 'shield' ? 'S' : 'T', this.x, this.y);
    }
  }

  // --- Globals ---
  let player = new Player();
  let bullets = [];
  let enemies = [];
  let powerUps = [];
  let keys = {};
  let enemySpawnTimer = 0;
  let enemySpawnInterval = 60; // frames
  let gameOver = false;

  // --- Input ---
  window.addEventListener('keydown', (e) => {
    keys[e.key.toLowerCase()] = true;
    if(!gameRunning && e.key === ' ') {
      startGame();
    }
  });
  window.addEventListener('keyup', (e) => {
    keys[e.key.toLowerCase()] = false;
  });

  // --- Game Functions ---
  function spawnEnemy() {
    // 70% chance basic, 30% hard enemy
    let type = Math.random() < 0.3 ? 'hard' : 'basic';
    enemies.push(new Enemy(type));
  }

  function update() {
    if(!gameRunning) return;

    // Update stars
    stars.forEach(star => star.update());

    // Player movement
    if(keys['arrowleft'] || keys['a']) player.move(-1);
    if(keys['arrowright'] || keys['d']) player.move(1);
    if(keys[' ']) player.shoot();

    player.update();

    // Spawn enemies
    enemySpawnTimer--;
    if(enemySpawnTimer <= 0){
      spawnEnemy();
      enemySpawnTimer = enemySpawnInterval;
      if(enemySpawnInterval > 20) enemySpawnInterval -= 0.05; // gradually faster spawn
    }

    // Update bullets
    bullets.forEach((b, i) => {
      b.update();
      if(b.y + b.radius < 0 || b.x < 0 || b.x > canvas.width){
        bullets.splice(i, 1);
      }
    });

    // Update enemies
    enemies.forEach((e, i) => {
      e.update();
      if(e.y > canvas.height){
        enemies.splice(i, 1);
        player.lives--;
        updateLivesDisplay();
        if(player.lives <= 0) gameOver = true;
      }
    });

    // Update powerups
    powerUps.forEach((p, i) => {
      p.update();
      if(p.y - p.radius > canvas.height) {
        powerUps.splice(i, 1);
      }
      // Collect powerup collision with player
      else if(
        p.x > player.x && p.x < player.x + player.width &&
        p.y + p.radius > player.y && p.y - p.radius < player.y + player.height
      ) {
        if(p.kind === 'shield') {
          player.powerUp = 'shield';
          player.powerUpTimer = 600; // 10 seconds
        } else if(p.kind === 'triple') {
          player.powerUp = 'triple';
          player.powerUpTimer = 600;
        }
        powerUps.splice(i, 1);
      }
    });

    // Bullet hits enemy
    bullets.forEach((b, bi) => {
      enemies.forEach((e, ei) => {
        if(b.x > e.x && b.x < e.x + e.width && b.y > e.y && b.y < e.y + e.height){
          e.health--;
          bullets.splice(bi, 1);
          if(e.health <= 0) {
            // Increase score
            score += e.points;
            updateScore();

            // Possibly drop powerup from hard enemy
            if(e.dropPowerUp) {
              if(Math.random() < 0.6) {
                let kind = Math.random() < 0.5 ? 'shield' : 'triple';
                powerUps.push(new PowerUp(e.x + e.width/2, e.y + e.height/2, kind));
              }
            }

            enemies.splice(ei, 1);
          }
        }
      });
    });

    if(gameOver) {
      endGame();
    }
  }

  function draw() {
    // Clear game canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw stars on star canvas
    starCtx.clearRect(0, 0, starCanvas.width, starCanvas.height);
    stars.forEach(star => star.draw(starCtx));

    // Draw player
    player.draw(ctx);

    // Draw bullets
    bullets.forEach(b => b.draw(ctx));

    // Draw enemies
    enemies.forEach(e => e.draw(ctx));

    // Draw powerups
    powerUps.forEach(p => p.draw(ctx));
  }

  function gameLoop() {
    update();
    draw();
    if(gameRunning) requestAnimationFrame(gameLoop);
  }

  // --- UI ---
  function updateScore() {
    scoreEl.textContent = score;
  }
  function updateLivesDisplay() {
    livesContainer.innerHTML = 'LIVES: ';
    for(let i=0; i<player.lives; i++) {
      const lifeIcon = document.createElement('div');
      lifeIcon.classList.add('life');
      livesContainer.appendChild(lifeIcon);
    }
  }

  // --- Start / End Game ---
  function startGame() {
    score = 0;
    player = new Player();
    bullets = [];
    enemies = [];
    powerUps = [];
    enemySpawnTimer = 0;
    enemySpawnInterval = 60;
    gameOver = false;
    gameRunning = true;
    updateScore();
    updateLivesDisplay();
    modalEl.classList.add('hidden');
    gameLoop();
  }
  function endGame() {
    gameRunning = false;
    modalScore.textContent = score;
    modalEl.classList.remove('hidden');
  }

  startGameBtn.addEventListener('click', () => {
    startGame();
  });

  // Initial display setup
  updateLivesDisplay();
  modalEl.classList.remove('hidden');

})();
</script>
</body>
</html>
